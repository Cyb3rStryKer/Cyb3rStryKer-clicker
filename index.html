<!DOCTYPE html>
<html lang="fr">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="UTF-8" />
  <title>CyberStryKer-clicker</title>

  <!-- police futuriste -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />

  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ mise en page fixe â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    html,body{
      margin:0;padding:0;height:100%;overflow:hidden;
      font-family:'Orbitron',sans-serif;background:#fefefe url('https://www.transparenttextures.com/patterns/pw-maze-white.png');color:#222;
      display:flex;flex-direction:column;align-items:center;
    }

    header{
      font-size:2.5rem;margin:30px 0 20px;
      background:linear-gradient(90deg,#00c6ff,#0072ff);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    #credits{font-size:1.5rem;margin-bottom:20px}

    /* bouton sac */
    #moneyBag{
      width:150px;cursor:pointer;transition:transform .1s;-webkit-tap-highlight-color:transparent;outline:none;border:none
    }
    #moneyBag:active{transform:scale(1.1)}

    /* boutons standards */
    .btn{
      margin-top:20px;padding:12px 20px;font-size:16px;border:none;border-radius:10px;cursor:pointer;transition:background .2s;-webkit-tap-highlight-color:transparent;outline:none
    }
    .btn-primary{background:#0072ff;color:#fff}
    .btn-primary:hover{background:#0056cc}
    .btn-green{background:#4caf50;color:#fff}
    .btn-red{background:#f44336;color:#fff}

    #message{margin-top:15px;font-size:1rem;color:green;min-height:1.2em}

    /* inventaire modal */
    #inventoryModal{
      display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      background:#fff;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,.4);padding:20px;
      width:90%;max-width:450px;max-height:80vh;overflow-y:auto;z-index:1000
    }
    #inventoryHeader{font-size:1.4rem;font-weight:bold;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    #inventoryContent table{width:100%;border-collapse:collapse;text-align:center}
    #inventoryContent th,#inventoryContent td{padding:8px;border-bottom:1px solid #ccc}
    #inventoryContent th{background:#0072ff;color:#fff}
    #inventoryContent tr:hover{background:#e0f0ff;cursor:pointer}
    .rarityBar{height:10px;border-radius:6px;margin-top:4px;width:100%}
    .rarity-common{background:#8bc34a}.rarity-uncommon{background:#2196f3}.rarity-rare{background:#9c27b0}.rarity-epic{background:#ff5722}.rarity-legendary{background:gold}

    /* confirmation fusion */
    #fusionConfirm{display:none;padding:10px;background:#eee;border:1px solid #aaa;border-radius:8px;text-align:center;margin-top:10px}

    /* animation fusion */
    .fusion-animate{animation:fusionEffect 1s forwards}
    @keyframes fusionEffect{
      0%{transform:scale(1);filter:brightness(1)}
      50%{transform:scale(1.3);filter:brightness(1.8)}
      100%{transform:scale(1);filter:brightness(1)}
    }

    /* accessibilitÃ© focus clavier */
    button:focus-visible,#moneyBag:focus-visible{outline:2px solid #0056cc}
    button:focus,#moneyBag:focus{outline:none}
  </style>
</head>
<body>

  <header>CyberStryKer-clicker</header>

  <div id="credits">ğŸ’° CrÃ©dits : <span id="creditCount">0</span></div>

  <img id="moneyBag" src="https://img.icons8.com/emoji/192/money-bag-emoji.png" alt="Sac Ã  cliquer" tabindex="0"/>

  <button id="buyBox" class="btn btn-primary">ğŸ“¦ Caisse (<span id="boxPrice">10</span>)</button>

  <div id="message"></div>

  <button id="inventoryButton" class="btn btn-primary">ğŸ“¥ Inventaire</button>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ MODAL INVENTAIRE â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="inventoryModal" role="dialog" aria-modal="true">
    <div id="inventoryHeader">
      Inventaire
      <button id="closeInventory" class="btn btn-primary" style="padding:4px 10px">âœ–</button>
    </div>
    <div id="inventoryContent"></div>

    <div id="fusionConfirm">
      <p>Fusionner ces 2 fruits : <strong id="fusionPairName"></strong> ?</p>
      <button class="btn btn-green" onclick="confirmFusion()">âœ… Oui</button>
      <button class="btn btn-red" onclick="cancelFusion()">âŒ Non</button>
    </div>
  </div>

  <!-- sons -->
  <audio id="fusionSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ donnÃ©es principales â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let credits  = 0;
let boxPrice = 10;
let boxCount = 0;

/* pool de fruits (icÃ´ne + multiplicateur) */
const fruitPool = [
  { name:"Pomme",   rarity:"common",     mult:1,   icon:"https://img.icons8.com/emoji/48/red-apple.png" },
  { name:"Banane",  rarity:"uncommon",   mult:1.5, icon:"https://img.icons8.com/emoji/48/banana-emoji.png" },
  { name:"Cerise",  rarity:"rare",       mult:2,   icon:"https://img.icons8.com/emoji/48/cherries.png" },
  { name:"Fraise",  rarity:"epic",       mult:3,   icon:"https://img.icons8.com/emoji/48/strawberry.png" },
  { name:"Kiwi",    rarity:"legendary",  mult:5,   icon:"https://img.icons8.com/emoji/48/kiwi-fruit.png" }
];

/* inventaire initial pour test */
let inventory = [];

/* fusion sÃ©lection */
let selectedFusion = [];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ fonctions utilitaires â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function rarityClass(r){return "rarity-"+r}
function playFusionSound(){const s=document.getElementById('fusionSound');s.currentTime=0;s.play();}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ affichages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateCredits(){document.getElementById('creditCount').textContent = credits}
function updateBoxPrice(){document.getElementById('boxPrice').textContent  = boxPrice}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ sauvegarde / chargement â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function saveGame(){
  const data={
    credits,boxPrice,boxCount,
    inventory:inventory.map(f=>f.name) // on stocke juste le nom
  };
  localStorage.setItem('cyberStrykerSave',JSON.stringify(data));
}
function loadGame(){
  const raw=localStorage.getItem('cyberStrykerSave');
  if(!raw) return;
  try{
    const data=JSON.parse(raw);
    credits   = data.credits  ?? credits;
    boxPrice  = data.boxPrice ?? boxPrice;
    boxCount  = data.boxCount ?? boxCount;
    inventory = (data.inventory||[]).map(n=>fruitPool.find(f=>f.name===n)).filter(Boolean);
  }catch(e){console.error('Save corrupt',e);}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ clic principal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('moneyBag').onclick = ()=>{
  const bonus = inventory.reduce((t,f)=>t+f.mult,0);
  credits += 1 + bonus;
  updateCredits(); saveGame();
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ achat caisse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('buyBox').onclick = ()=>{
  if(credits < boxPrice){showMessage("Pas assez !");return;}
  credits -= boxPrice; boxCount++; boxPrice = Math.floor(boxPrice*1.1);
  // attribuer fruit alÃ©atoire
  const idx = Math.floor(Math.random()*fruitPool.length);
  inventory.push({...fruitPool[idx]});
  showMessage(`ğŸ ${fruitPool[idx].name} obtenu !`);
  updateCredits(); updateBoxPrice(); saveGame();
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ inventaire modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.getElementById('inventoryButton').onclick = toggleInventory;
document.getElementById('closeInventory').onclick  = toggleInventory;

function toggleInventory(){
  const m=document.getElementById('inventoryModal');
  if(m.style.display==='block'){m.style.display='none';selectedFusion=[];hideConfirm();}
  else {m.style.display='block';renderInventory();}
}
function renderInventory(){
  const cont=document.getElementById('inventoryContent');
  cont.innerHTML='';
  if(inventory.length===0){cont.innerHTML='<p>Inventaire vide</p>';return;}

  const table=document.createElement('table');
  const thead=`<thead><tr><th>#</th><th>Fruit</th><th>RaretÃ©</th><th>Ã—</th></tr></thead>`;
  table.innerHTML=thead;
  const tbody=document.createElement('tbody');
  inventory.forEach((f,i)=>{
    const tr=document.createElement('tr'); tr.dataset.index=i;
    tr.innerHTML=`<td>${i+1}</td>
      <td><img src="${f.icon}" width="24" style="vertical-align:middle;margin-right:6px">${f.name}</td>
      <td><div class="rarityBar ${rarityClass(f.rarity)}"></div></td>
      <td>${f.mult.toFixed(1)}</td>`;
    tr.onclick=()=>selectForFusion(i);
    tbody.appendChild(tr);
  });
  table.appendChild(tbody); cont.appendChild(table); highlightSelected();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ sÃ©lection / confirmation fusion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function selectForFusion(i){
  if(selectedFusion.includes(i)){selectedFusion=selectedFusion.filter(x=>x!==i);}
  else{
    if(selectedFusion.length===2){showMessage("Max 2 fruits");return;}
    selectedFusion.push(i);
  }
  highlightSelected();
  if(selectedFusion.length===2){
    const [a,b]=selectedFusion;
    if(inventory[a].name===inventory[b].name){showConfirm(inventory[a].name);}
    else {selectedFusion=[];highlightSelected();showMessage("Fruits diffÃ©rents !");}
  }else hideConfirm();
}
function highlightSelected(){
  document.querySelectorAll('#inventoryContent tbody tr').forEach((tr,i)=>{
    tr.style.backgroundColor = selectedFusion.includes(i)?'#b0d7ff':'';});
}
function showConfirm(name){
  document.getElementById('fusionPairName').textContent=name;
  document.getElementById('fusionConfirm').style.display='block';
}
function hideConfirm(){document.getElementById('fusionConfirm').style.display='none';}

function confirmFusion(){
  if(selectedFusion.length!==2)return;
  const name=inventory[selectedFusion[0]].name;
  const idxBase=fruitPool.findIndex(f=>f.name===name);
  if(idxBase<fruitPool.length-1){
    // retirer fruits
    inventory = inventory.filter((_,i)=>!selectedFusion.includes(i));
    // ajouter supÃ©rieur
    inventory.push({...fruitPool[idxBase+1]});
    playFusionSound();
    showMessage(`Fusion ! ${fruitPool[idxBase+1].name} obtenu !`);
  }else showMessage("DÃ©jÃ  au max !");
  selectedFusion=[];hideConfirm();renderInventory();saveGame();
}
function cancelFusion(){selectedFusion=[];hideConfirm();highlightSelected();}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ utilitaires â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showMessage(t){
  const m=document.getElementById('message');m.textContent=t;
  setTimeout(()=>{if(m.textContent===t)m.textContent='';},2500);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ dÃ©marrage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
loadGame(); updateCredits(); updateBoxPrice();
setInterval(saveGame,30000); // autosave toutes 30 s
</script>
</body>
</html>
