<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CyberStryKer-clicker</title>

<!-- ‚Äî‚Äî‚Äî‚Äî‚Äî Styles ‚Äî‚Äî‚Äî‚Äî‚Äî -->
<style>
:root{
  --bg:#fff8e1;--text:#5d4037;--panel:#fff3e0;--border:#fb8c00;
}
body.dark{
  --bg:#222;--text:#f5f5f5;--panel:#333;--border:#00c6ff;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden;font-family:'Comic Sans MS',cursive;background:var(--bg);color:var(--text);user-select:none}
#topBar{position:fixed;top:10px;right:10px;display:flex;gap:10px;z-index:100}
.topBtn{background:var(--border);border:none;border-radius:8px;color:#fff;font-size:1.4rem;padding:6px 10px;cursor:pointer}
#container{display:flex;height:100vh}
#leftPanel,#rightPanel{flex:1;padding:20px;overflow:hidden}
#rightPanel{background:var(--panel);border-left:4px solid var(--border);overflow-y:auto}
h1{text-align:center;text-shadow:1px 1px 0 var(--border);margin-bottom:10px}
#creditsDisplay{font-size:1.8rem;text-align:center;background:#ffe0b2;border:3px solid var(--border);border-radius:15px;padding:8px 20px;margin:10px auto 20px auto;min-width:180px}
#clickBagBtn{margin:10px auto;font-size:2.4rem;width:100px;height:100px;border-radius:50%;border:3px solid #b71c1c;background:#d32f2f;color:#fff;cursor:pointer;box-shadow:4px 4px 0 #7b0000;transition:transform .15s}
#clickBagBtn:active{transform:scale(.9)}
#levelContainer{text-align:center;font-weight:bold;margin-top:10px}
#xpBarBg{width:80%;margin:8px auto;height:18px;border:2px solid var(--border);border-radius:9px;background:#ddd;overflow:hidden}
#xpBarFill{height:100%;width:0%;background:linear-gradient(90deg,orange,gold)}
#message{text-align:center;min-height:24px;margin-top:10px;font-weight:bold}
#buyBoxBtn{display:block;width:100%;margin-top:20px;padding:14px;border:none;border-radius:12px;font-size:1.1rem;background:var(--border);color:#fff;cursor:pointer}

.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--panel);border:3px solid var(--border);border-radius:12px;padding:20px;z-index:200;display:none;max-width:90%;max-height:80%;overflow-y:auto}
.popup h3{margin-bottom:10px;text-align:center}
.invItem{display:flex;align-items:center;gap:8px;margin-bottom:6px;padding:6px 10px;border:2px solid var(--border);border-radius:10px;background:var(--bg);transition:transform .15s}
.invItem:hover{transform:scale(1.03)}
.invItem button{margin-left:auto;background:#d32f2f;border:none;border-radius:6px;color:#fff;cursor:pointer;padding:4px 6px}

.rarity-common{border-left:6px solid gray;}
.rarity-rare{border-left:6px solid #3399ff;background:#e3f2fd}
.rarity-epic{border-left:6px solid purple;background:#f3e5f5}
.rarity-mythic{border-left:6px solid orange;background:#fff8e1}
.rarity-legendary{border-left:6px solid gold;background:#fff8e1;animation:glow 1.5s ease-in-out infinite alternate}
@keyframes glow{from{box-shadow:0 0 6px gold}to{box-shadow:0 0 18px gold}}

button:focus{outline:none}
</style>
</head>
<body>

<!-- ‚Äî‚Äî‚Äî barre sup√©rieure (boutons) ‚Äî‚Äî‚Äî -->
<div id="topBar">
  <button class="topBtn" id="inventoryBtn" title="Inventaire">üì¶</button>
  <button class="topBtn" id="settingsBtn"  title="Param√®tres">‚öôÔ∏è</button>
  <button class="topBtn" id="resetBtn"     title="R√©initialiser">üíæ</button>
</div>

<!-- ‚Äî‚Äî‚Äî structure principale ‚Äî‚Äî‚Äî -->
<div id="container">
  <!-- gauche -->
  <div id="leftPanel">
    <h1>CyberStryKer-clicker</h1>
    <div id="creditsDisplay">0 $</div>
    <button id="clickBagBtn" title="Clique pour gagner !">üí∞</button>

    <div id="levelContainer">
      Niveau <span id="level">1</span>
      <div id="xpBarBg"><div id="xpBarFill"></div></div>
    </div>

    <div id="message"></div>
  </div>

  <!-- droite -->
  <div id="rightPanel">
    <h2>Bo√Æte Myst√®re</h2>
    <button id="buyBoxBtn">üì¶ Acheter une caisse (<span id="boxPrice">10</span> $)</button>
  </div>
</div>

<!-- ‚Äî‚Äî‚Äî Pop-ups ‚Äî‚Äî‚Äî -->
<div id="inventoryPopup" class="popup">
  <h3>Inventaire</h3>
  <div id="inventoryList">Aucun fruit</div>
  <button onclick="closePopup('inventoryPopup')">Fermer</button>
</div>

<div id="settingsPopup" class="popup">
  <h3>Param√®tres</h3>
  <label><input type="checkbox" id="darkToggle"> Mode sombre</label>
  <button onclick="closePopup('settingsPopup')">Fermer</button>
</div>

<div id="confirmReset" class="popup">
  <p>R√©initialiser toutes les donn√©es ?</p>
  <button onclick="showPopup('confirmFinal')">Oui</button>
  <button onclick="closePopup('confirmReset')">Non</button>
</div>

<div id="confirmFinal" class="popup">
  <p>√ätes-vous vraiment s√ªr ?</p>
  <button onclick="resetAll()">Oui</button>
  <button onclick="closePopup('confirmFinal')">Non</button>
</div>

<!-- ‚Äî‚Äî‚Äî Audios (simples) ‚Äî‚Äî‚Äî -->
<audio id="clickSnd"  src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>
<audio id="fruitSnd"  src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
<audio id="fusionSnd" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

<!-- ‚Äî‚Äî‚Äî Script ‚Äî‚Äî‚Äî -->
<script>
/* ===== Donn√©es ===== */
let credits  = 0;
let boxCount = 0;
let boxPrice = 10;

let xp      = 0;
let xpNext  = 100;
let level   = 1;

let inventory = {};  // {fruitName: count}

const fruits = [
  { name:"üçè Pomme",  rarity:"Commun",    class:"rarity-common",    boost:0.01, chance:80 },
  { name:"üçì Fraise", rarity:"Rare",      class:"rarity-rare",      boost:0.10, chance:15 },
  { name:"üçç Ananas", rarity:"√âpique",    class:"rarity-epic",      boost:0.50, chance:4.5},
  { name:"üêâ Dragon", rarity:"Mythique",  class:"rarity-mythic",    boost:1.00, chance:0.4},
  { name:"üçá Raisin", rarity:"L√©gendaire",class:"rarity-legendary", boost:10.0, chance:0.1}
];

/* ===== Utilitaires ===== */
const $ = id => document.getElementById(id);
function format(n){
  if (n>=1e9) return (n/1e9).toFixed(1)+"B";
  if (n>=1e6) return (n/1e6).toFixed(1)+"M";
  if (n>=1e3) return (n/1e3).toFixed(1)+"k";
  return Math.floor(n);
}
function play(id){ $(id).currentTime=0; $(id).play(); }

/* ===== Sauvegarde ===== */
function save(){
  localStorage.setItem("csCredits",credits);
  localStorage.setItem("csBoxCount",boxCount);
  localStorage.setItem("csBoxPrice",boxPrice);
  localStorage.setItem("csXP",xp);
  localStorage.setItem("csXPNext",xpNext);
  localStorage.setItem("csLevel",level);
  localStorage.setItem("csInv",JSON.stringify(inventory));
  localStorage.setItem("csDark",document.body.classList.contains("dark"));
}
function load(){
  credits  = parseFloat(localStorage.getItem("csCredits"))||0;
  boxCount = parseInt(localStorage.getItem("csBoxCount"))||0;
  boxPrice = parseInt(localStorage.getItem("csBoxPrice"))||10;
  xp       = parseFloat(localStorage.getItem("csXP"))||0;
  xpNext   = parseFloat(localStorage.getItem("csXPNext"))||100;
  level    = parseInt(localStorage.getItem("csLevel"))||1;
  inventory= JSON.parse(localStorage.getItem("csInv")||"{}");
  if(localStorage.getItem("csDark")==="true") {document.body.classList.add("dark"); $("darkToggle").checked=true;}
}

/* ===== Mise √† jour UI ===== */
function refresh(){
  $("creditsDisplay").textContent = format(credits)+" $";
  $("boxPrice").textContent = boxPrice;
  $("level").textContent = level;
  $("xpBarFill").style.width = (xp/xpNext*100)+"%";
}
function updateInventory(){
  const list=$("inventoryList");
  list.innerHTML="";
  if(Object.keys(inventory).length===0){list.textContent="Aucun fruit";return;}
  for(const name in inventory){
    const fruit=fruits.find(f=>f.name===name);
    const div=document.createElement("div");
    div.className="invItem "+fruit.class;
    div.innerHTML=`<span>${name}</span><span>x${inventory[name]}</span><span>(√ó${fruit.boost})</span>
      <button onclick="fuseFruit('${name}')">‚ö°</button>`;
    list.appendChild(div);
  }
}

/* ===== Logique ===== */
function totalBoost(){
  let boost=1;
  for(const n in inventory){
    const fruit=fruits.find(f=>f.name===n);
    boost+=inventory[n]*fruit.boost;
  }
  return boost;
}

function clickBag(){
  play("clickSnd");
  credits+=totalBoost();
  xp+=5;
  if(xp>=xpNext){
    xp-=xpNext; level++; xpNext=Math.floor(xpNext*1.5);
    showMsg("Niveau "+level+" atteint !");
  }
  refresh(); save();
}

function buyBox(){
  if(credits<boxPrice){showMsg("Pas assez de cr√©dits !");return;}
  credits-=boxPrice;
  boxCount++;
  if(boxCount===1)      boxPrice=50;
  else if(boxCount===2) boxPrice=100;
  else if(boxPrice<1000)boxPrice+=100;
  else                  boxPrice+=1000;

  // tirage
  const r=Math.random()*100;
  let acc=0,fruit;
  for(const f of fruits){acc+=f.chance;if(r<=acc){fruit=f;break;}}
  inventory[fruit.name]=(inventory[fruit.name]||0)+1;
  play("fruitSnd");
  showMsg(`+1 ${fruit.name} (${fruit.rarity})`);
  refresh(); updateInventory(); save();
}

function fuseFruit(name){
  if(inventory[name]<2){showMsg("Il faut au moins 2 fruits identiques.");return;}
  if(!confirm("Fusionner 2 "+name+" ?"))return;
  inventory[name]-=2; inventory[name]+=1;
  play("fusionSnd"); showMsg(name+" fusionn√© !");
  updateInventory(); refresh(); save();
}

/* ===== Pop-ups helpers ===== */
function showPopup(id){ $(id).style.display="block";}
function closePopup(id){ $(id).style.display="none";}
function toggleInventory(){ showPopup("inventoryPopup"); updateInventory();}
function toggleSettings(){ showPopup("settingsPopup"); }
function confirmReset(){ showPopup("confirmReset"); }
function resetAll(){ localStorage.clear(); location.reload(); }

function showMsg(txt){ $("message").textContent=txt; setTimeout(()=>{if($("message").textContent===txt)$("message").textContent=""},3000);}

/* ===== Init ===== */
window.addEventListener("DOMContentLoaded",()=>{
  load(); refresh(); updateInventory();
  // listeners
  $("darkToggle").onchange=e=>{document.body.classList.toggle("dark",e.target.checked); save();};
  setInterval(save,5000); // autosave
});
</script>
</body>
</html>
