<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jeu de Fruits</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }
    #clickBagBtn {
      font-size: 3em;
      width: 110px;
      height: 110px;
      background-color: #d32f2f;
      border: 4px solid #b71c1c;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      box-shadow: 6px 6px 0 #7b0000;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 30px;
      transition: background-color 0.2s, transform 0.15s;
      user-select: none;
      line-height: 1;
      text-align: center;
      padding: 0;
    }
    #clickBagBtn:active {
      transform: scale(0.95);
      background-color: #a12020;
    }
    #credits {
      font-size: 2em;
      margin-bottom: 15px;
      font-weight: bold;
      color: #333;
    }
    #inventory {
      margin-top: 20px;
      width: 320px;
      max-width: 90vw;
    }
    #inventory h2 {
      margin-bottom: 10px;
      color: #444;
      text-align: center;
    }
    #inventoryList {
      list-style: none;
      padding: 0;
      margin: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      max-height: 300px;
      overflow-y: auto;
    }
    #inventoryList li {
      padding: 8px 12px;
      border-bottom: 1px solid #ddd;
      font-size: 1.1em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #inventoryList li:last-child {
      border-bottom: none;
    }
    #message {
      margin-top: 15px;
      min-height: 40px;
      font-size: 1.2em;
      color: #555;
      text-align: center;
      min-width: 320px;
      max-width: 90vw;
      padding: 10px;
      background: #fffbe6;
      border: 1px solid #f1d600;
      border-radius: 6px;
      box-shadow: 0 0 8px #f1d600aa;
      user-select: none;
    }
    #buyMysteryBoxBtn {
      margin-top: 30px;
      padding: 12px 30px;
      font-size: 1.3em;
      background-color: #00695c;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 5px 0 #004d40;
      transition: background-color 0.2s;
      user-select: none;
    }
    #buyMysteryBoxBtn:active {
      background-color: #004d40;
      box-shadow: 0 2px 0 #002a22;
      transform: translateY(3px);
    }
  </style>
</head>
<body>

  <div id="credits">Cr√©dits: 0 $</div>

  <button id="clickBagBtn" title="Clique ici pour r√©colter des fruits">üçé</button>

  <button id="buyMysteryBoxBtn">Acheter une caisse myst√®re (20 $)</button>

  <div id="message"></div>

  <div id="inventory">
    <h2>Inventaire</h2>
    <ul id="inventoryList"></ul>
  </div>

  <script>
    // Donn√©es fruits avec raret√©s et sons
    const fruits = [
      { name: "Pomme üçé", rarity: "Commun", value: 3, sound: "pop" },
      { name: "Banane üçå", rarity: "Commun", value: 4, sound: "pop" },
      { name: "Cerise üçí", rarity: "Rare", value: 10, sound: "sparkle" },
      { name: "Ananas üçç", rarity: "Rare", value: 12, sound: "sparkle" },
      { name: "Kiwi ü•ù", rarity: "Tr√®s Rare", value: 25, sound: "shimmer" },
      { name: "Melon üçà", rarity: "Tr√®s Rare", value: 30, sound: "shimmer" },
      // Fruits Mythique
      { name: "Durian Mythique ü••", rarity: "Mythique", value: 60, sound: "mystic" },
      { name: "Fruit du Dragon Mythique üêâ", rarity: "Mythique", value: 75, sound: "mystic" },
      // Fruits L√©gendaire
      { name: "Pom√©lo L√©gendaire üçä", rarity: "L√©gendaire", value: 120, sound: "legend" },
      { name: "Cerise de Feu L√©gendaire üî•", rarity: "L√©gendaire", value: 150, sound: "legend" }
    ];

    const sounds = {
      pop: new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg'),
      sparkle: new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg'),
      shimmer: new Audio('https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg'),
      click: new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg'),
      error: new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg'),
      cash: new Audio('https://actions.google.com/sounds/v1/cash_register/cash_register.ogg'),
      mystic: new Audio('https://actions.google.com/sounds/v1/magic/medium_magic_chime.ogg'),
      legend: new Audio('https://actions.google.com/sounds/v1/magic/majestic_harp.ogg')
    };

    let credits = 0;
    const inventory = {};

    const creditsDisplay = document.getElementById('credits');
    const clickBagBtn = document.getElementById('clickBagBtn');
    const messageBox = document.getElementById('message');
    const inventoryList = document.getElementById('inventoryList');
    const buyMysteryBoxBtn = document.getElementById('buyMysteryBoxBtn');

    // Met √† jour affichage cr√©dits
    function updateCreditsDisplay() {
      creditsDisplay.textContent = `Cr√©dits: ${credits} $`;
    }

    // Met √† jour inventaire visuel
    function updateInventoryDisplay() {
      inventoryList.innerHTML = "";
      const sortedFruits = Object.keys(inventory).sort((a, b) => {
        // Tri alphab√©tique simple
        return a.localeCompare(b);
      });
      sortedFruits.forEach(fruitName => {
        const li = document.createElement('li');
        li.textContent = `${fruitName} x${inventory[fruitName]}`;
        inventoryList.appendChild(li);
      });
    }

    // Affiche un message temporaire
    function updateMessage(text) {
      messageBox.textContent = text;
    }

    // Joue un son depuis la liste
    function playSound(name) {
      if (sounds[name]) {
        sounds[name].currentTime = 0;
        sounds[name].play().catch(() => {});
      }
    }

    // Fonction clic principal: r√©colte un fruit commun al√©atoire
    clickBagBtn.addEventListener('click', () => {
      // Tirage dans fruits communs uniquement
      const commonFruits = fruits.filter(f => f.rarity === "Commun");
      const picked = commonFruits[Math.floor(Math.random() * commonFruits.length)];

      inventory[picked.name] = (inventory[picked.name] || 0) + 1;
      credits += picked.value;

      updateCreditsDisplay();
      updateInventoryDisplay();
      updateMessage(`Vous avez r√©colt√© : ${picked.name} (+${picked.value} $)`);
      playSound(picked.sound);
    });

    // Tirage caisse myst√®re avec pond√©ration selon raret√©
    function buyMysteryBox() {
      const boxPrice = 20;
      if (credits < boxPrice) {
        updateMessage("Pas assez de cr√©dits pour acheter une caisse !");
        playSound("error");
        return;
      }
      credits -= boxPrice;
      updateCreditsDisplay();

      const weightedFruits = [];
      fruits.forEach(fruit => {
        let weight = 1;
        if (fruit.rarity === "Commun") weight = 5;
        else if (fruit.rarity === "Rare") weight = 3;
        else if (fruit.rarity === "Tr√®s Rare") weight = 2;
        else if (fruit.rarity === "Mythique") weight = 1;
        else if (fruit.rarity === "L√©gendaire") weight = 0.5;
        const times = Math.max(1, Math.floor(weight * 2));
        for (let i = 0; i < times; i++) weightedFruits.push(fruit);
      });

      const picked = weightedFruits[Math.floor(Math.random() * weightedFruits.length)];

      inventory[picked.name] = (inventory[picked.name] || 0) + 1;
      credits += picked.value;

      updateCreditsDisplay();
      updateInventoryDisplay();
      updateMessage(`Vous avez re√ßu : ${picked.name} (${picked.rarity}) ! +${picked.value} $`);
      playSound(picked.sound);
    }

    buyMysteryBoxBtn.addEventListener('click', buyMysteryBox);

    // Initialisation
    updateCreditsDisplay();
    updateInventoryDisplay();
    updateMessage("Clique sur le sac rouge pour r√©colter des fruits !");
  </script>

</body>
</html>
